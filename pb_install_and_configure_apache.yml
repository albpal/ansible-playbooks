# This Ansible playbook install and configure an Apache Web Server
---
- hosts: apache
  remote_user: apalau
  vars:
# The password has been generated with the command line: python -c 'import crypt; print(crypt.crypt("themostsecretword", crypt.mksalt(crypt.METHOD_SHA512)))'
    apache_password: $6$o18j/OQERryMtxwS$tPwj8MEpdBYBn8ciaBxRlrTPmwhvZ7sTx2k6Q5RHnAghJl6hbU6Dnx8o.FBRy40aLi4kdv3azpkYeR6Q9R81y/
    http_port: 8080
  tasks:
  - name: ensure apache is at latest version
    yum: name=httpd state=latest
    become: true
  - name: ensure Apache is running (and enable it at boot)
    service: name=httpd state=started enabled=yes
    become: true
  - name: ensure user apache exists
    user:
       name: apache
       group: apache
       comment: "Apache user"
       shell: /bin/bash
       update_password: on_create
       password: "{{apache_password}}"
       state: present
    become: true
    #notify: "Restart sshd"  
  handlers:
    - name: Restart sshd
      service:
        name: sshd
        state: restarted

